version: 1
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            - |
              set -euo pipefail
              # Attempt to ensure a full git history when the repo is shallow (common in CI)
              if SHALLOW_STATE=$(git rev-parse --is-shallow-repository 2>/dev/null); then
                if [ "$SHALLOW_STATE" = "true" ]; then
                  if git remote get-url origin >/dev/null 2>&1; then
                    git fetch origin --prune --unshallow 2>/dev/null || git fetch origin --prune --depth=2147483647 || true
                  else
                    echo "Skipping git history expansion: no origin remote configured"
                  fi
                else
                  echo "Repository already has complete git history"
                fi
              else
                # Older git: fall back to checking .git/shallow if present
                if [ -f .git/shallow ]; then
                  git fetch --prune --unshallow || true
                else
                  echo "Shallow state unknown; leaving history as-is"
                fi
              fi
            - echo "No pre-build steps required"
        build:
          commands:
            - echo "Static site: no build step required"
      artifacts:
        baseDirectory: .
        files:
          - '**/*'
